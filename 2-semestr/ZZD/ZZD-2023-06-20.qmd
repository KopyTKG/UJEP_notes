---
title: "ZZD-2023-06-20"
author: "Martin Kopecký"
format: html
editor: visual
---

```{r}
rm(list=ls())

library(dplyr)
library(ggplot2)
library(tidyr)
library(knitr)
library(rnaturalearthdata)
library(sf)
library(rnaturalearth)
```

## Úkol 1

### 1.1

Pro načtení tabulky byl použit příkaz **read.csv()**

```{r}
table <- read.csv("./MCD64A1_burned_area_full_dataset_2002-2019.csv")
```

### 1.2

Vyhledání limitů tabulky jako jsou

-   Poslední rok
-   Úvodní rok
-   vybranné sloupce
-   vytažení světových dat pro použití na vykreslení

```{r}
top <- table[1, ]$Year
bottom <- table[nrow(table), ]$Year
selected_columns <- c("Cropland_BA_hectares", "Forest_BA_hectares", "Grass_and_Shrubland_BA_hectares", "Wetlands_BA_hectares", "Settlement_BA_hectares", "Other_BA_hectares")
world <- ne_countries(scale="medium", returnclass = "sf")
countries <- unique(table$Country)
```

### 1.3

výpočet celkového počtu požárů za pomocí procházení pomocí for cyklu přes roky. Dále se litruje tabulka pomocí roku. Poté se sčítájí všechny předem vybrané sloupce pro danný rok. Jako poslední krok byl vytvořen řádek obsahující rok a celkovou hodnutu.

```{r}
calculated_data = data.frame()

for(i in top:bottom) {
  year_selected <- table %>% filter(Year == i)
  total <- 0
  for(column in selected_columns) {
    total <- total + sum(year_selected[[column]] != 0)
  }
  new <- data.frame(Year= i, Total= total)
  calculated_data <- rbind(calculated_data, new)
}

```

vykreslení grafu za pomocí ggplot knihovny. Přes příkazy geom_line a geom_smooth. Pro dosažení cíleného vzhledu je použita funkce geom_point s parametrem shape=2 (Trojúhelník)

```{r}

ggplot(data= calculated_data, aes(x=Year, y=Total)) + geom_line()+ geom_point(shape=2) + geom_smooth()

```

### 1.4

Opakovaný postup pro získání pod tabulek za danný rok. Na dále byl zvolen samotný sloupec z předem vybraných sloupců. Jednotlivé sloupce jsou nadále sčítaný do hromady ze všech států. Jako výstup je tabulka kde je sloupce rok a dále sloupce předem vybranné.

```{r}
calculated_data_columns = data.frame()

for(i in top:bottom) {
  year_selected <- table %>% filter(Year == i)
  total <- rep(0, length(selected_columns))
  for(column in selected_columns) {
    total[which(selected_columns == column)] <- total[which(selected_columns == column)] + sum(year_selected[[column]])
  }
  new <- data.frame(Year= i)
  for(i in 1:length(selected_columns)) {
    new$key <- selected_columns[i]
    new$value <- total[i]
    calculated_data_columns <- rbind(calculated_data_columns, new)
  }
}

```

kreslení za pomocí příkazů geom_line a geom_point (shape=16 je kolečko)

```{r}
ggplot(data=calculated_data_columns, aes(x=Year, y=value, color= key)) + geom_line() + geom_point(shape=16)
```

## Úloha 2

### 2.1

Získání názvů států z původní tabulky. Vytvoření výstupní tabulky. Dále se prochází skrz jednotlivé státy za pomocí filtru. Nadále se prochází skrze vybrané sloupce které jsou sečteny do jedné neznámé. Vše je uloženo do jedné tabulky. Tabulka je spojena s světovou tabulkou.

```{r}
calculated_data_map <- data.frame()

for(country in countries) {
  country_selected <- table %>% filter(Country == country)
  total <- 0
  for(column in selected_columns) {
    total <- total + sum(country_selected[[column]] != 0)
  }
  new <- data.frame(name= country,  Total= total)
  calculated_data_map <- rbind(calculated_data_map, new)
}
world_joined_total <- left_join(world, calculated_data_map, by="name")
```

vykreslení za pomocí sloupců geometry a Total + knihovny sf

```{r}
world_joined_total %>% ggplot(aes(geometry=geometry, fill=Total)) + geom_sf() 
```

### 2.2

Zde se opakuje postup pro vybrání jednotlivých států. Nadále jsou vybrány sloupce obsahující data o požárech, které jsou sečteny do sloupců obsahující jen jednu hodnotu. Tato hodnota je poté porovnána k zjištění max hodnoty a je vybrán název sloupce. Vše je uloženo do tabulky spojené s světovou tabulkou.

```{r}
calculated_data_map <- data.frame()

for(country in countries) {
  country_selected <- table %>% filter(Country == country)
  country_selected_sumed <- colSums(country_selected[, c(selected_columns)])

  new <- data.frame(name= country,  Total=selected_columns[which.max(country_selected_sumed)])
  calculated_data_map <- rbind(calculated_data_map, new)
}
world_joined_Max <- left_join(world, calculated_data_map, by="name")
```

vykreslední

```{r}
world_joined_Max %>% ggplot(aes(geometry=geometry, fill=Total)) + geom_sf() 
```

## Úloha 3

### 3.1

Na úvodu je vybráná podtabulka obsahující data jen z Kanady. Dále jsou vybrány regióny. Přes for cyklus procházím skrz regióny a filtruji sloupec Lesních požáru, který sčítam na příč roky. Vše je poté uloženo do tabulky obsahující regióny a area. Nakonec je tabulka seřazena a Vypsána

```{r}
selected_canada <- table %>% filter(Country == "Canada")
regions <- unique(selected_canada$Region)

canada_data = data.frame()

for(region in regions) {
  region_selected <- selected_canada %>% filter(Region == region)
  new <- data.frame(Region=0, area=0)
  new$Region <- region
  new$area <- sum(region_selected$Forest_BA_hectares)
  new$Cropland_BA_hectare <- sum(region_selected$Cropland_BA_hectare)
  new$Forest_BA_hectares <- sum(region_selected$Forest_BA_hectares)
  new$Grass_and_Shrubland_BA_hectares <- sum(region_selected$Grass_and_Shrubland_BA_hectares)
  new$Wetlands_BA_hectares <- sum(region_selected$Wetlands_BA_hectares)
  new$Settlement_BA_hectares <- sum(region_selected$Settlement_BA_hectares)
  new$Other_BA_hectares <- sum(region_selected$Other_BA_hectares)

  canada_data <- rbind(canada_data, new)
  
}
canada_data <- canada_data[order(canada_data$area, decreasing = TRUE),]
canada_print <- canada_data[,c("Region", "area")]
kable(canada_print)
```

Vykreslení sloupcového grafu s modifikačním příkazem coord_polar.

```{r}
ggplot(data= canada_data, aes(x="", y=area, fill=Region)) + geom_bar(stat = "identity", width = 1) + coord_polar(theta = "y")
```

### 3.2

```{r}
canada_data[1:6]

for(i in 1:6) {
   ggplot(data=canada_data[i], aes(x= Region, y=))
}
```
